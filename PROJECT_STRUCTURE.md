# Партограмма ДАР - Документация проекта

## Общая информация

- **Название**: Партограмма ДАР
- **Тип**: Веб-приложение на Ruby Sinatra
- **Назначение**: Система управления пациентами и партограммами в роддоме
- **Текущая версия**: 2.0 (рефакторинг дизайна)
- **Основной язык**: Ruby
- **Шаблонизатор**: ERB
- **Фронтенд**: Bootstrap 5 + кастомный CSS
- **База данных**: SQLite (предположительно, через ActiveRecord)

## Структура проекта

### Основные директории
/
├── app.rb # Главный файл Sinatra-приложения
├── config.ru # Конфигурация Rack
├── Gemfile # Зависимости Ruby
├── Gemfile.lock
├── public/ # Статические файлы
│ ├── css/ # Стили
│ │ ├── theme.css # Основная тема (CSS-переменные)
│ │ ├── components/ # Компоненты
│ │ │ ├── navbar.css
│ │ │ ├── cards.css
│ │ │ ├── forms.css
│ │ │ └── tables.css
│ │ ├── utilities.css # Утилитарные классы
│ │ └── responsive/ # Адаптивные стили
│ │ └── tablet.css
│ ├── js/
│ │ └── app.js # Основной JavaScript
│ └── images/ # Изображения
│ ├── logo.png # Логотип
│ └── favicon.png # Иконка
├── views/ # Шаблоны ERB
│ ├── layout.erb # Основной макет
│ ├── index.erb # Список пациентов
│ ├── edit.erb # Редактирование пациента
│ ├── new.erb # Создание пациента
│ └── ... # Другие шаблоны
└── models/ # Модели (предположительно)
└── patient.rb # Модель пациента

text

### Ключевые файлы и их назначение

#### 1. Основное приложение (`app.rb`)
- Точка входа приложения
- Определение маршрутов Sinatra
- Обработка HTTP-запросов
- Взаимодействие с моделями

#### 2. Макет (`views/layout.erb`)
- Основной HTML-каркас всех страниц
- Подключение CSS и JavaScript
- Навигационная панель
- Отображение уведомлений (flash messages)
- Футер

#### 3. Статические ресурсы (`public/`)
**CSS структура:**
- `theme.css` - глобальные CSS-переменные и настройки Bootstrap
- `components/` - стили для отдельных компонентов UI
- `utilities.css` - вспомогательные классы
- `responsive/` - медиа-запросы для адаптивности

**JavaScript:**
- `app.js` - весь клиентский JavaScript
  - Фильтрация пациентов (AJAX)
  - Управление модальными окнами
  - Инициализация компонентов
  - Вспомогательные функции

#### 4. Шаблоны представлений (`views/`)
- `index.erb` - список пациентов с фильтрами
- `edit.erb` - форма редактирования пациента
- `new.erb` - форма создания нового пациента
- Каждый шаблон наследует от `layout.erb`

## Цветовая схема и дизайн

### Основные цвета
```css
--bs-primary: #54c654;     /* Основной зеленый */
--bs-primary-dark: #3a8a3a; /* Темный зеленый */
--bs-primary-light: #e8f5e9;/* Светлый зеленый */
--bs-secondary: #6c757d;    /* Серый для второстепенных элементов */
Градиенты
css
--gradient-primary: linear-gradient(135deg, #54c654 0%, #3a8a3a 100%);
Семантические цвета
Success: #28a745

Danger: #dc3545

Warning: #ffc107

Info: #17a2b8

Компоненты интерфейса
1. Навигация (navbar.css)
Фиксированная верхняя панель с градиентом

Адаптивное меню для мобильных устройств

Логотип + название приложения

Активные состояния ссылок

2. Карточки (cards.css)
Карточки с тенями и скругленными углами

Заголовки с градиентным фоном

Плавные hover-эффекты

Адаптивные отступы

3. Формы (forms.css)
Сетка (form-grid-modern) для расположения полей

Секции форм (form-section-modern)

Стилизованные поля ввода (input-modern)

Адаптивное расположение кнопок

4. Таблицы (tables.css)
Минималистичный дизайн с разделителями

Бейджи статусов с цветовой кодировкой

Компактные кнопки действий

Анимация строк при обновлении

JavaScript архитектура
Основные функции в app.js
applyFilters() - AJAX-фильтрация пациентов

Получает параметры из формы фильтров

Отправляет запрос на /api/patients

Обновляет таблицу через updatePatientsTable()

updatePatientsTable(patients) - рендеринг таблицы

Динамическое создание строк таблицы

Обработка пустых результатов

Инициализация кнопок действий

initDeleteButtons() - управление удалением

Открытие модального окна подтверждения

Отправка DELETE-запроса с CSRF-токеном

showLoading(show) - индикатор загрузки

showAlert(message, type) - всплывающие уведомления

Инициализация
Все обработчики событий навешиваются в DOMContentLoaded.

Медиа-запросы и адаптивность
Точки останова
≥1200px: Десктоп (большие экраны)

992px-1199px: Десктоп (средние экраны)

768px-991px: Планшеты (альбомная ориентация)

576px-767px: Планшеты (портретная ориентация)

<576px: Мобильные устройства

Особенности для планшетов
Уменьшенные отступы и размеры шрифтов

Изменение сетки форм с 2 колонок на 1

Адаптивное меню навигации

Компактные кнопки действий в таблице

Соглашения и лучшие практики
1. Наименование классов CSS
Используйте префиксы для компонентов: card-modern, form-modern

Для модификаторов: bg-primary, status-badge-modern

Утилитарные классы: mt-4, text-center

2. Структура HTML
Каждая страница наследует layout.erb

Формы используют класс form-modern и сетку form-grid-modern

Карточки используют card-modern и card-body-modern

Таблицы используют table-modern

3. JavaScript
Все функции глобально доступны через window

Обработка ошибок с пользовательскими сообщениями

Использование data-* атрибутов для хранения метаданных

4. Изображения
Логотип: /public/images/logo.png (рекомендуемый размер 32px в высоту)

Фавикон: /public/images/favicon.png

Все изображения в public/images/

Создание новых представлений
Шаблон для нового ERB-файла:
erb
<%# 
  Название: [Название страницы]
  Путь: /путь/к/странице
  Назначение: [Краткое описание]
%>

<div class="card card-modern fade-in-card">
  <div class="card-header-modern text-white">
    <h5 class="card-title">
      <i class="bi bi-[иконка] me-2"></i>[Заголовок страницы]
    </h5>
  </div>
  <div class="card-body-modern">
    <!-- Контент страницы -->
    
    <!-- Если есть форма -->
    <form action="[URL_действия]" method="post" class="form-modern">
      <div class="form-section-modern">
        <h6 class="form-section-title-modern">
          <i class="bi bi-[иконка]"></i> [Название секции]
        </h6>
        <div class="form-grid-modern">
          <!-- Поля формы -->
          <div>
            <label for="field_id" class="form-label-modern">Название поля</label>
            <input type="text" 
                   class="form-control input-modern" 
                   id="field_id" 
                   name="model[field]">
          </div>
        </div>
      </div>
      
      <!-- Кнопки действий -->
      <div class="form-actions-modern">
        <a href="[URL_назад]" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left me-1"></i>Назад
        </a>
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-check-circle me-1"></i>Сохранить
        </button>
      </div>
    </form>
  </div>
</div>
Правила для новых представлений:
Всегда начинайте с карточки card-modern

Используйте стандартные заголовки card-header-modern

Для форм применяйте классы form-modern, form-section-modern, form-grid-modern

Используйте input-modern для полей ввода

Размещайте кнопки действий в form-actions-modern

Добавляйте иконки Bootstrap Icons

Для таблиц используйте table-modern и table-actions-modern

API Endpoints
Существующие:
GET /api/patients - список пациентов с фильтрацией

Параметры: search, status, admission_date, filter_by_date

Возвращает JSON-массив пациентов

POST /patients - создание пациента

PUT /patients/:id - обновление пациента

DELETE /patients/:id - удаление пациента

Расширение функционала
Добавление нового типа данных:
Создайте модель в models/

Добавьте маршруты в app.rb

Создайте представления в views/

При необходимости добавьте стили в public/css/components/

Обновите JavaScript при необходимости

Добавление нового фильтра:
Добавьте поле в форму фильтров в index.erb

Обновите функцию applyFilters() в app.js

Обновите API endpoint для обработки нового параметра

При необходимости добавьте стили

Устранение неполадок
Распространенные проблемы:
Кнопки не работают после AJAX-обновления

Убедитесь, что initDeleteButtons() вызывается после обновления DOM

Проверьте, что обработчики событий навешиваются правильно

Стили не применяются

Проверьте порядок подключения CSS-файлов в layout.erb

Убедитесь, что классы правильно указаны в HTML

Проблемы с адаптивностью

Проверьте медиа-запросы в tablet.css

Убедитесь, что viewport meta-тег установлен правильно

Не работают формы

Проверьте наличие CSRF-токена

Убедитесь, что метод и action формы указаны правильно

Контакты и поддержка
Разработчик: iMprov

Технологии: Ruby, Sinatra, Bootstrap 5, JavaScript

Статус: Активная разработка